#!/bin/bash

echo "Development -> github.com/alanlucena"
echo "Version 1.0.0"
echo "Importing && Generating certificates"
echo "This script is used to move the burpsuite certificate to the android cacerts folder"

############################################
#             CERTIFICATE GEN              #
############################################

#This section is only necessary if the emulator, even with root and the burpsuite certificate, still has a certificate authority error. (These are rare cases).

#yes "" | openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem
#openssl x509 -text -noout -in certificate.pem
#openssl pkcs12 -inkey key.pem -in certificate.pem -export -out certificate.p12 -password pass:{YOUR_PASS_HERE}
#hash_number=`openssl x509 -inform PEM -subject_hash_old -in certificate.pem | head -1`
#cp certificate.pem $hash_number'.0'

############################################
#                AUTO ROOT                 #
############################################

echo "Starting root"

hash=`ls -lah *.0 | awk '{print $9}'`
adb root
adb shell avbctl disable-verification
adb reboot

#Wait reboot your device
sleep 100

#Move certificates to trusted certs in Android security directory

adb root
adb remount
adb push "$hash" /sdcard/
adb shell "mv /sdcard/$hash /system/etc/security/cacerts/"
adb shell "chmod 644 /system/etc/security/cacerts/$hash"
adb shell "chown root:root /system/etc/security/cacerts/$hash"
adb shell "ls -la /system/etc/security/cacerts/ | grep $hash"
adb shell "reboot"                                              

echo "Root was done sucessfully"
